{% extends "static_base.html" %}
{% load staticfiles %}

{% block head_style %}
body { background: #e8e8e8; }
form { margin-top: 50px;}

.content { background: #fff; color: #333; margin: 20px; padding: 40px; border-radius: 3px; border: 1px solid #ccc; border-radius: 5px; box-shadow: 0 0 5px 0px #ccc; }

p { font-size: 16px; }

    .consent-header { background: #4b2e83; color: #fff; margin:-40px -40px 15px -40px; border-radius: 5px 5px 0 0; }
{% endblock %}

{% block content %}
            <div class="row consent-header">
                <div class="col-md-12">
                    <h1>University of Washington Research Experiment</h1>
                    <p>Primary Investigator: John Robinson (soco @ uw.edu )</p>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <div class="vertical-spacer"></div>

                    <h2>Requirements</h2>
                    <ul>
                        <li>Keyboard</li>
                        <li>Modern Web Browser such as:
                            <ul>
                                <li>Chrome 33+</li>
                                <li>Firefox 10+</li>
                                <li>Safari 6.1.6+</li>
                                <li>Internet Explorer 10+</li>
                            </ul>
                        </li>
                        <li><strong>Cookies and Javascript Enabled</strong></li>
                        <li><p><strong>Disable Ad blocking and privacy software</strong></p><p>This experiment requires twitter scripts to be enabled, and some ad blocking programs prevent this from working. Read more about our information collection policy below</p>
                    </ul>

                    <h2>Purpose</h2>

                    <p>We are asking you to be in a research study. You must be an adult to be in this study. The purpose of this experiment is to explore methods for improving labelling experiences and the quality of those labels. This study is part of a larger study investigating uncertainty and information during a crisis event, and to help train computers to detect this.</p>

                    <h2>Procedures</h2>
                    <p>You will be asked to label tweets from a crisis event. This task will include instruction and attention checks. You will also be given two brief, optional surveys. Your responses, or lack thereof will not impact your payment. This should take about 20-25 minutes.</p>

                    <p>All of the tweets are publicly available as of the time the experiment was posted.</p>

                    <h2>Risks, Stress, or Discomfort</h2>
                    <p>The tweets in this study deal with an actual crisis event. Some people may find the content upsetting. Although we do not require any personal information, we cannot guarantee any data you give will remain confidential.</p>

                    <h2>Confidentiality</h2>
                    <p>We cannot guarantee the confidentiality of your responses in this study. Although we make attempts to keep your responses secure, through password protection, and encryption where possible, but it may be vulnerable to hacks or theft.</p>
                    <p>Breach of confidentiality is a risk to being in this study if it happened that your responses, linked to your identifiers, were seen by or were taken by someone who should not have them.</p>

                    <h2>Benefits</h2>
                    <p>This study is not designed to benefit you. Your payment is based on accurately answering a majority (greater than 50%) of the attention checks and the rate is determined by the standards of the platform. Your participation in this study may be used to train computers to detect uncertainty, and to help during future crises. </p>


                    <h2>Collected Information</h2>
                    <p>We collection information, including optional demographic and feedback information which could be used to identify you. Although we will attempt to store this securely, but we cannot guarantee your confidentiality. </p>
                    <p>This is the information being collected.
                        <ul>
                            <li>Web browser (User Agent): <span id="ua"></span></li>
                            <li>Web Browser Vendor: <span id="vendor"></span></li>
                            <li>Platform / OS: <span id="platform"></span></li>
                            <li>Language: <span id="lang"></span></li>
                            <li>Browser resolution: <span id="width"></span> x <span id="height"></span></li>
                        </ul>
                    </p>

                    <h2>Other Information</h2>
                    <p>Being in the study is voluntary and can stop at any time.  Refusing to be in the study or stopping participation will involve no penalty or loss of benefits to which you are otherwise entitled. General questions about this research should be directed to the <a href="mailto:soco@uw.edu">soco@uw.edu</a>. 

                    <p>Questions about subject rights should be directed to:</p>
                    <p>University of Washington</br>Human Subjects Division</br>(206) â€“ 543 - 0098</br>
                    </p>

                </div>
            </div>


            <div class="row">
                <div class="col-md-12">
                    <p>By pressing the &quot;I Agree&quot; button below, you certify that you are an adult and consent to participating in this study and for the information listed above to be sent to our servers.</p>
                </div>
            </div>

            <!-- Requirement Checks -->
            <div id="req_check">
                <div class="row req" id="req-header">
                    <div class="col-md-12">
                        <h3>Verifying Requirments...</h3>
                    </div>
                </div>
                <div class="row req" id="req-js">
                    <div class="col-md-12">
                        <p>Javascript Enabled:
                            <span class="result">
                                <noscript><span class="fail">Failed</span></noscript>
                            </span>
                        </p>
                        <noscript>
                            <div class="alert alert-danger" role="alert">
                                <h3>Javascript is disabled.</h3>
                                <p>You must enable Javascript before you are able to proceed.</p>
                                <p>Once you have done this, refresh this page in order to continue other tests.</p>
                            </div>
                        </noscript>
                    </div>
                </div>

                <div class="row req" id="req-cookies">
                    <div class="col-md-12">
                        <p>Cookies Enabled: 
                            <span class="result">
                                <span class="req-checking hidden"><span class="spinner"></span> Checking... </span>
                                <noscript><span class="fail">Failed</span> <span>(This test requires JavaScript)</span></noscript>
                            </span>
                        </p>
                        <div class="alert alert-danger hidden" role="alert">
                            <h3>Cookies are disabled.</h3>
                            <p>You must enable cookies before you can continue.</p>
                            <p>Refresh your browser after you have enabled cookies.</p>
                        </div>
                    </div>
                </div>  

                <div class="row req" id="req-twitter">
                    <div class="col-md-12">
                        <p>Twitter Scripts Enabled: 
                            <span class="result">
                                <span class="req-checking hidden"><span class="spinner"></span> Checking...</span>
                                <noscript><span class="fail">Failed</span> <span>(This test requires JavaScript)</span></noscript>
                            </span>
                        </p>
                        <div id="alert-no-twitter" class="alert alert-danger hidden" role="alert">
                            <h3>Twitter Script is disabled.</h3>
                            <p>Do you have an ad blocker or privacy extension installed? You need to disable it for this site.</p>
                            <p>This task requires scripts to be loaded from Twitter. If you are running an privacy or adblock extension, you need to disable blocking for this site or allow Twitter's scripts to run. To help protect your privacy, our pages include code telling Twitter not to track you on this site. The script is only used to render content according to Twitter's rules.</p>
                            <p>After you've disabled this, refresh the page to make sure it's disabled.</p>
                        </div>

                    </div>
                </div>      
            </div>

            <!-- Agree -->
            <div class="row">
                <form action="." method="post" class="form">
                    <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">
                    <input type="hidden" value="" name="browser_info">      
                    <div id="submit-container">
                        <div class="req-testing">
                            <h4>Waiting for Twitter script to load...</h4>
                            <p><span class="spinner"></span>(waiting <span id="tw-wait"></span> more seconds)</p>
                        </div>
                        <div class="req-error hidden">
                            <div class="alert alert-danger" role="alert">
                                <p><strong>Requirements Failed</strong></p>
                                <p>Your browser does not meet the requirements to take this experiment.</p>
                                <p>The requirements section (above) will show you which failed. Make sure you have cookies and JavaScript enabled. Also make sure to disable all ad-blocking and privacy extensions for this site.</p>
                            </div>
                        </div>
                    </div>
                </form>
            </div>

{% endblock %}

{% block script_includes %}
    <script src="{% static "js/req-check.js" %}"></script>
{% endblock %}

{% block final_script %}

var success_html = "<span class='success'><span class='glyphicon glyphicon-ok'></span> Success!</span>",
    failure_html = "<span class='fail'><span class='glyphicon glyphicon-remove'></span> Failed.</span>";


function updateStatus(parent_id, value) {
    var text = failure_html;
    if(value === true) {
        text = success_html;
        $(parent_id).find(".alert").addClass("hidden");
    } else if(value === false ) {
        $(parent_id).find(".alert").removeClass("hidden");
    }

    // don't update text if it's null
    if(value !== null) {
        // set the text
        $(parent_id).find(".result").html(text);    
    }

}

function updatePage(rq) {
    updateStatus("#req-cookies", rq.cookieEnabled);
    updateStatus("#req-twitter", rq.twitterEnabled);
}

function onReqCheckSuccess(rq) {
    updatePage(rq);
    show_submit();
}

function onReqCookiesFailed(rq) {
    updatePage(rq);
    show_req_error();
}

function onReqTwitterFailed(rq) {
    updatePage(rq);
    show_req_error();
}


function onReqUpdateTwitterStatus(rq, d) {
    updatePage(rq);
    $("#tw-wait").text(d);
}

(function(reqcheck){


    var rq = new reqcheck.ReqCheck(
        onReqCheckSuccess,
        onReqCookiesFailed,
        onReqTwitterFailed,
        onReqUpdateTwitterStatus
    )

    $("#req-js .result").html(success_html);

})(RequirementCheck);


function show_req_error() {
    $(".req-error").removeClass("hidden");
    $(".req-testing").addClass("hidden");
}

function show_submit() {
    $("#req_check").addClass("hidden");
    $(".req-testing").addClass("hidden");
    $("#submit-container").html('<button type="submit" class="btn btn-primary">I Agree</button>');

    $("button[type='submit']").on("click", function(ev){
        var $f = $('form'),
            ns = {
                'ua': navigator.userAgent, 
                'vndr': navigator.vendor,
                'pltfrm': navigator.platform,
                'loc':navigator.language,
                'wdth': $(window).width(),
                'hght': $(window).height()
            },
            stats = $.extend(ns, window.screen)
            $i = $('<input/>', {
                type: 'hidden',
                name: 'browser_info',
                value: JSON.stringify(stats)
            });

        $f.append($i);


        ev.preventDefault();
        $f.submit();
    });


}

(function(){

    $(".req-checking").removeClass("hidden");
    $(".spinner").spin('tiny');     

    
    $("#ua").text(navigator.userAgent);
    $("#vendor").text(navigator.vendor);
    $("#platform").text(navigator.platform);
    $("#lang").text(navigator.language);
    $("#width").text($(window).width());
    $("#height").text($(window).height());



})();

{% endblock %}



